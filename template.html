<!DOCTYPE html>
<html lang="zh-CN" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DevLog | æç®€æŠ€æœ¯åšå®¢</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                fontFamily: {
                    sans: ['Inter', '-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'sans-serif'],
                    mono: ['JetBrains Mono', 'monospace'],
                },
                extend: {
                    colors: {
                        primary: { 500: '#3b82f6', 600: '#2563eb' }
                    }
                }
            }
        }
    </script>

    <!-- Libs -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400&display=swap" rel="stylesheet">

    <style>
        /* Base */
        body { font-family: 'Inter', sans-serif; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 3px; }
        .dark ::-webkit-scrollbar-thumb { background-color: #475569; }

        /* Typography */
        .prose > :first-child { margin-top: 0; }
        .prose h2 { font-size: 1.5rem; font-weight: 700; margin-top: 2.5rem; margin-bottom: 1.25rem; scroll-margin-top: 6rem; }
        .prose h3 { font-size: 1.25rem; font-weight: 600; margin-top: 2rem; margin-bottom: 1rem; scroll-margin-top: 6rem; }
        .prose p { margin-bottom: 1.25rem; line-height: 1.8; color: inherit; }
        .prose ul, .prose ol { margin: 1.25rem 0; padding-left: 1.25rem; }
        .prose li { margin: 0.5rem 0; }
        .prose hr { margin: 2rem 0; border-color: rgba(148, 163, 184, 0.35); }
        .prose pre { background: #1e293b; padding: 1.25rem; border-radius: 0.5rem; overflow-x: auto; margin-bottom: 1.5rem; border: 1px solid rgba(255,255,255,0.1); }
        .prose blockquote { border-left: 4px solid #3b82f6; padding-left: 1rem; padding-top: 0.25rem; padding-bottom: 0.25rem; font-style: italic; color: #64748b; background: rgba(59, 130, 246, 0.05); }
        .dark .prose blockquote { color: #94a3b8; }
        .prose img { border-radius: 0.5rem; margin: 1.5rem 0; width: 100%; }
        .prose a { color: #3b82f6; text-decoration: underline; text-underline-offset: 4px; }
        
        /* Animation */
        .fade-in { animation: fadeIn 0.4s ease-out forwards; opacity: 0; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .modal-backdrop { backdrop-filter: blur(4px); background-color: rgba(0,0,0,0.5); }

        /* TOC Active State */
        .toc-link.active { color: #3b82f6; font-weight: 600; border-left-color: #3b82f6; }

        /* Reading Progress */
        #reading-progress { transform-origin: 0 0; transform: scaleX(0); }
    </style>
</head>

<body class="bg-gray-50 text-slate-800 dark:bg-gray-950 dark:text-slate-200 transition-colors duration-300 min-h-screen flex flex-col">

    <!-- Navbar -->
    <header class="sticky top-0 z-40 w-full backdrop-blur-md bg-white/80 dark:bg-gray-900/80 border-b border-gray-200 dark:border-gray-800">
        <div class="max-w-5xl mx-auto px-4 h-16 flex items-center justify-between">
            <a href="#home" onclick="router.push('home')" class="font-bold text-lg tracking-tight hover:opacity-80 transition-opacity">
                Dev<span class="text-blue-600">Log</span>
            </a>
            <div class="flex items-center gap-6">
                <nav class="hidden md:flex items-center gap-5 text-sm font-medium text-gray-500 dark:text-gray-400">
                    <a href="#home" class="nav-item hover:text-black dark:hover:text-white transition-colors">é¦–é¡µ</a>
                    <a href="#categories" class="nav-item hover:text-black dark:hover:text-white transition-colors">åˆ†ç±»</a>
                    <a href="#tags" class="nav-item hover:text-black dark:hover:text-white transition-colors">æ ‡ç­¾</a>
                    <a href="#links" class="nav-item hover:text-black dark:hover:text-white transition-colors">å‹é“¾</a>
                    <a href="#about" class="nav-item hover:text-black dark:hover:text-white transition-colors">å…³äº</a>
                </nav>
                <div class="h-4 w-[1px] bg-gray-300 dark:bg-gray-700 hidden md:block"></div>
                <div class="flex items-center gap-3">
                    <button id="search-btn" class="p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-gray-500">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                    </button>
                    <button id="theme-toggle" class="p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-gray-500">
                        <svg id="sun-icon" class="w-5 h-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                        <svg id="moon-icon" class="w-5 h-5 block" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
                    </button>
                    <button id="mobile-menu-btn" class="md:hidden p-2 rounded-md text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-800">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                    </button>
                </div>
            </div>
        </div>
        <div id="mobile-menu" class="hidden md:hidden border-t border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900 absolute w-full shadow-lg">
            <div class="px-4 py-2 space-y-1">
                <a href="#home" class="block px-3 py-2 rounded-md text-sm font-medium hover:bg-gray-100 dark:hover:bg-gray-800">é¦–é¡µ</a>
                <a href="#categories" class="block px-3 py-2 rounded-md text-sm font-medium hover:bg-gray-100 dark:hover:bg-gray-800">åˆ†ç±»</a>
                <a href="#tags" class="block px-3 py-2 rounded-md text-sm font-medium hover:bg-gray-100 dark:hover:bg-gray-800">æ ‡ç­¾</a>
                <a href="#about" class="block px-3 py-2 rounded-md text-sm font-medium hover:bg-gray-100 dark:hover:bg-gray-800">å…³äº</a>
            </div>
        </div>
    </header>

    <!-- Reading Progress -->
    <div id="reading-progress" class="fixed top-0 left-0 z-50 h-0.5 w-full bg-blue-600/80 dark:bg-blue-500/80 pointer-events-none hidden"></div>

    <!-- Search Modal -->
    <div id="search-modal" class="fixed inset-0 z-50 hidden">
        <div class="modal-backdrop absolute inset-0 transition-opacity" onclick="searchManager.close()"></div>
        <div class="relative z-10 max-w-xl mx-auto mt-24 p-4">
            <div class="bg-white dark:bg-gray-900 rounded-xl shadow-2xl overflow-hidden border border-gray-200 dark:border-gray-700">
                <div class="flex items-center border-b border-gray-100 dark:border-gray-800 p-4">
                    <svg class="w-5 h-5 text-gray-400 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                    <input id="search-input" type="text" placeholder="æœç´¢æ–‡ç« ..." class="w-full bg-transparent outline-none text-gray-900 dark:text-gray-100" autocomplete="off">
                </div>
                <div id="search-results" class="max-h-[50vh] overflow-y-auto p-2"></div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main id="app" class="flex-grow w-full max-w-5xl mx-auto px-4 py-8 md:py-10">
        <!-- Views Injected Here -->
    </main>

    <!-- Back to Top Container (Aligned with content) -->
    <div class="fixed inset-x-0 bottom-0 mx-auto max-w-5xl pointer-events-none z-40 px-4 mb-8">
        <button id="back-to-top" class="absolute right-4 bottom-0 p-3 rounded-full bg-blue-600 text-white shadow-lg hover:bg-blue-700 transition-all opacity-0 translate-y-10 pointer-events-auto">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path></svg>
        </button>
    </div>

    <!-- Footer -->
    <footer class="border-t border-gray-200 dark:border-gray-800 mt-auto bg-white dark:bg-gray-950">
        <div class="max-w-5xl mx-auto px-4 py-8 text-center">
            <p class="text-sm text-gray-600 dark:text-gray-400 mb-2">&copy; 2024 DevLog. Designed with <span class="text-red-500">â™¥</span> by Frontend Expert.</p>
            <p class="text-xs text-gray-400">Powered by Single File System</p>
        </div>
    </footer>

    <!-- Logic -->
    <script>
        // --- 1. CONFIG ---
        const renderer = new marked.Renderer();
        const slugify = (value) => String(value ?? '')
            .trim()
            .toLowerCase()
            .replace(/[^\w\u4e00-\u9fa5]+/g, '-')
            .replace(/^-+|-+$/g, '');

        // Marked v5+ may pass a token object instead of (text, level).
        renderer.heading = function(textOrToken, levelMaybe) {
            const isToken = !!textOrToken && typeof textOrToken === 'object';
            const text = isToken ? (textOrToken.text ?? '') : textOrToken;
            const level = isToken ? (textOrToken.depth ?? levelMaybe) : levelMaybe;
            const escapedText = slugify(text);
            return `<h${level} id="${escapedText}" class="scroll-mt-24">${text}</h${level}>`;
        };
        marked.use({ renderer });

        const DB = {
            categories: [
                { id: 'tech', name: 'æŠ€æœ¯å¹²è´§', emoji: 'ğŸ’»', desc: 'Web å‰ç«¯ã€æ¶æ„è®¾è®¡ä¸ä»£ç ç¾å­¦' },
                { id: 'life', name: 'ç”Ÿæ´»éšç¬”', emoji: 'â˜•', desc: 'å’–å•¡ã€æ—…è¡Œä¸æ—¥å¸¸çš„ç¢ç¢å¿µ' },
                { id: 'reading', name: 'ä¹¦å•å½±è¯„', emoji: 'ğŸ“š', desc: 'ç²¾ç¥é£Ÿç²®ï¼Œæ·±åº¦é˜…è¯»ä¸è§‚å½±æ„Ÿæ‚Ÿ' },
                { id: 'design', name: 'UI è®¾è®¡', emoji: 'ğŸ¨', desc: 'åƒç´ çº§çš„æ‰§ç€ï¼Œè‰²å½©ä¸äº¤äº’ä¹‹ç¾' }
            ],
            tags: ['JavaScript', 'CSS', 'Vue', 'React', 'Minimalism', 'Coffee', 'Travel', 'Review', 'Photography', 'Indie Hacker'],
            posts: [
                {
                    id: 1,
                    title: 'æ·±å…¥ç†è§£ CSS Grid å¸ƒå±€',
                    summary: 'äºŒç»´å¸ƒå±€çš„ç»ˆæè§£å†³æ–¹æ¡ˆï¼Œä»åŸºç¡€æ¦‚å¿µåˆ°å®æˆ˜ã€‚',
                    date: '2024-03-15',
                    categoryId: 'tech',
                    tags: ['CSS', 'Minimalism'],
                    content: '## ä¸ºä»€ä¹ˆé€‰æ‹© Grid?\n\nåœ¨ CSS Grid å‡ºç°ä¹‹å‰ï¼Œæˆ‘ä»¬ä¸€ç›´åœ¨ç”¨ Hack çš„æ–¹å¼åšå¸ƒå±€ã€‚ä» `table` åˆ° `float`ï¼Œå†åˆ° `flex`ï¼Œè™½ç„¶ Flexbox è§£å†³äº†ä¸€ç»´å¸ƒå±€çš„ç—›ç‚¹ï¼Œä½†é¢å¯¹å¤æ‚çš„äºŒç»´ç½‘æ ¼ï¼ŒGrid æ‰æ˜¯ç‹è€…ã€‚'
                        + '\n\n### æ ¸å¿ƒæ¦‚å¿µ\n\n1. **Container**: å®¹å™¨\n2. **Item**: é¡¹ç›®\n3. **Track**: è¡Œæˆ–åˆ—\n\n```css\n.container {\n  display: grid;\n  grid-template-columns: repeat(3, 1fr);\n  gap: 20px;\n}\n```\n\n> Grid è®©æˆ‘ä»¬èƒ½å¤Ÿç”¨ä»£ç æè¿°å¹³é¢è®¾è®¡çš„ç½‘æ ¼ç³»ç»Ÿï¼Œè¿™æ˜¯ Web è®¾è®¡çš„ä¸€å¤§é£è·ƒã€‚'
                        + '\n\n## ä» Flex åˆ° Gridï¼šå¦‚ä½•é€‰æ‹©ï¼Ÿ\n\nä¸€ä¸ªå®ç”¨çš„åˆ¤æ–­æ ‡å‡†ï¼š\n\n- **ä¸€ç»´**ï¼ˆåªéœ€è¦åœ¨ä¸€æ¡è½´ä¸Šæ’å¸ƒï¼‰ï¼šä¼˜å…ˆç”¨ Flexã€‚\n- **äºŒç»´**ï¼ˆåŒæ—¶éœ€è¦æ§åˆ¶è¡Œå’Œåˆ—ï¼‰ï¼šGrid ä¼šæ›´â€œå¯¹å‘³â€ã€‚\n- **å¤æ‚å“åº”å¼å¡ç‰‡å¢™**ï¼šGrid çš„ `auto-fit/auto-fill + minmax()` å¾ˆçœå¿ƒã€‚\n\nFlex ä¹Ÿèƒ½åšäºŒç»´ï¼Œä½†ä½ ä¼šå†™å‡ºå¾ˆå¤šâ€œå¥—å¨ƒâ€çš„å®¹å™¨ï¼›Grid åˆ™æ›´åƒæ˜¯åœ¨æè¿°ä¸€ä¸ªâ€œç½‘æ ¼ç³»ç»Ÿâ€ï¼Œè¡¨è¾¾åŠ›æ›´å¼ºã€‚'
                        + '\n\n## å…ˆæŠŠç½‘æ ¼ç”»å‡ºæ¥ï¼šåˆ—ã€è¡Œä¸é—´è·\n\n`grid-template-columns` / `grid-template-rows` å†³å®šäº†ç½‘æ ¼çš„éª¨æ¶ã€‚\n\n```css\n.grid {\n  display: grid;\n  grid-template-columns: 200px 1fr 200px;\n  grid-template-rows: auto 1fr auto;\n  gap: 16px;\n}\n```\n\nå½“ä½ çœ‹åˆ°â€œå·¦ä¾§å›ºå®š + ä¸­é—´è‡ªé€‚åº” + å³ä¾§å›ºå®šâ€è¿™ç±»éœ€æ±‚ï¼ŒGrid åŸºæœ¬å°±æ˜¯æ ‡å‡†ç­”æ¡ˆã€‚'
                        + '\n\n## å‘½ååŒºåŸŸï¼šGrid Template Areas\n\nå½“å¸ƒå±€æ›´åƒæ‹¼å›¾æ—¶ï¼Œå¯ä»¥ç”¨ `grid-template-areas` æå‡å¯è¯»æ€§ã€‚\n\n```css\n.layout {\n  display: grid;\n  grid-template-columns: 240px 1fr;\n  grid-template-rows: auto 1fr;\n  grid-template-areas:\n    \"header header\"\n    \"sidebar main\";\n  gap: 16px;\n}\n.header { grid-area: header; }\n.sidebar { grid-area: sidebar; }\n.main { grid-area: main; }\n```\n\nè¯»ä»£ç å°±åƒè¯»è®¾è®¡ç¨¿ï¼šä¸€çœ¼çŸ¥é“é¡µé¢è¢«åˆ†æˆäº†å“ªäº›åŒºåŸŸã€‚'
                        + '\n\n### ç»å…¸ä¸‰æ ï¼ˆåœ£æ¯/åŒé£ç¿¼çš„ç°ä»£å†™æ³•ï¼‰\n\n```css\n.page {\n  display: grid;\n  grid-template-columns: 260px minmax(0, 1fr) 220px;\n  gap: 20px;\n}\n```\n\n`minmax(0, 1fr)` æ˜¯ä¸ªå°æŠ€å·§ï¼šé¿å…ä¸­é—´æ å†…å®¹è¿‡é•¿å¯¼è‡´å¸ƒå±€æº¢å‡ºã€‚'
                        + '\n\n### å“åº”å¼å¡ç‰‡å¢™ï¼šauto-fit + minmax\n\n```css\n.cards {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));\n  gap: 16px;\n}\n```\n\nè¿™å‡ è¡Œèƒ½è¦†ç›–å¤§éƒ¨åˆ†â€œå¡ç‰‡åˆ—è¡¨ + è‡ªé€‚åº”åˆ—æ•°â€çš„ä¸šåŠ¡é¡µé¢ã€‚'
                        + '\n\n## å¯¹é½ï¼šåˆ«å†ç”¨ margin é­”æ³•äº†\n\nGrid æä¾›ä¸¤å¥—å¯¹é½ç³»ç»Ÿï¼š\n\n- **ç½‘æ ¼æ•´ä½“åœ¨å®¹å™¨ä¸­æ€ä¹ˆæ‘†**ï¼š`justify-content` / `align-content`\n- **ç½‘æ ¼é¡¹åœ¨ç½‘æ ¼å•å…ƒé‡Œæ€ä¹ˆæ‘†**ï¼š`justify-items` / `align-items`ï¼ˆä»¥åŠå•é¡¹çš„ `justify-self` / `align-self`ï¼‰\n\nå½“ä½ éœ€è¦â€œæ•´ä½“å±…ä¸­ä½†å•é¡¹å·¦å¯¹é½â€ï¼Œæˆ–â€œæŸä¸ªå¡ç‰‡å³ä¸‹è§’å¯¹é½â€æ—¶ï¼Œè¿™å¥— API ä¼šéå¸¸é¡ºæ‰‹ã€‚'
                        + '\n\n## è‡ªåŠ¨æ”¾ç½®ï¼šgrid-auto-flow\n\n```css\n.masonryLike {\n  display: grid;\n  grid-auto-flow: row dense;\n  grid-template-columns: repeat(6, 1fr);\n  gap: 12px;\n}\n```\n\n`dense` ä¼šå°è¯•å¡«è¡¥ç©ºæ´ï¼Œä½†ä¹Ÿå¯èƒ½æ‰“ä¹±è§†è§‰é¡ºåºï¼›ç”¨ä¹‹å‰å…ˆç¡®è®¤ä½ çš„å†…å®¹é¡ºåºæ˜¯å¦æ•æ„Ÿã€‚'
                        + '\n\n## è°ƒè¯•æŠ€å·§ï¼šç”¨ DevTools è¯»ç½‘æ ¼\n\nChrome/Edge çš„ DevTools å¯¹ Grid éå¸¸å‹å¥½ï¼š\n\n- æ‰“å¼€å…ƒç´ é¢æ¿ï¼Œå‹¾é€‰ Grid overlayï¼Œå¯ä»¥ç›´è§‚çœ‹åˆ°ç½‘æ ¼çº¿å’ŒåŒºåŸŸã€‚\n- å…ˆè°ƒå¥½ `gap`ï¼Œå†è°ƒåˆ—å®½ï¼ˆå›ºå®š/è‡ªé€‚åº”ï¼‰ï¼Œæœ€åå†å¤„ç†å¯¹é½ã€‚\n\nä¸è¦ä¸€ä¸Šæ¥å°±å†™ä¸€å † `grid-column`ï¼Œå…ˆæŠŠâ€œåº•å›¾â€ç”»ç¨³ï¼Œåé¢çš„å®šä½ä¼šè½»æ¾å¾ˆå¤šã€‚'
                        + '\n\n## å°ç»“\n\nå¦‚æœè¯´ Flex æ˜¯â€œæ’é˜Ÿâ€ï¼Œé‚£ Grid æ›´åƒâ€œæ’åº§ä½â€ã€‚å½“é¡µé¢çš„å¸ƒå±€æ„å›¾æ˜¯äºŒç»´ç»“æ„æ—¶ï¼ŒGrid ä¼šè®©ä½ çš„ä»£ç æ›´çŸ­ã€æ›´æ¸…æ™°ã€æ›´ä¸å®¹æ˜“å´©ã€‚'
                },
                { id: 2, title: 'ä¸ºä»€ä¹ˆæˆ‘æ”¾å¼ƒäº† React è½¬æŠ• Vue', summary: 'Vue 3 Composition API å¸¦æ¥çš„å¼€å‘ä½“éªŒæå‡ã€‚', date: '2024-02-28', categoryId: 'tech', tags: ['Vue', 'React', 'JavaScript'], content: '## è¿™æ˜¯ä¸€ä¸ªè‰°éš¾çš„å†³å®š\n\nReact çš„ç”Ÿæ€æ¯‹åº¸ç½®ç–‘æ˜¯å¼ºå¤§çš„ã€‚Hooks çš„è®¾è®¡æ€æƒ³ä¹Ÿéå¸¸è¶…å‰ã€‚ä½†æ˜¯ï¼Œ**Vue 3 çš„ Composition API ç»“åˆ Script Setup** ç»™æˆ‘å¸¦æ¥äº†ä¹…è¿çš„çˆ½å¿«æ„Ÿã€‚\n\n### å“åº”å¼ç³»ç»Ÿçš„å·®å¼‚\n\nReact çš„ `useEffect` ä¾èµ–æ•°ç»„æœ‰æ—¶æ˜¯ä¸ªå¿ƒæ™ºè´Ÿæ‹…ï¼Œè€Œ Vue çš„è‡ªåŠ¨ä¾èµ–è¿½è¸ªï¼ˆAuto-trackingï¼‰è®©ä»£ç é€»è¾‘æ›´åŠ ç›´è§‚ã€‚\n\n```javascript\n// Vue 3\nconst count = ref(0);\nconst double = computed(() => count.value * 2);\n```\n\nå½“ç„¶ï¼Œå·¥å…·æ²¡æœ‰ä¼˜åŠ£ä¹‹åˆ†ï¼Œåªæœ‰é€‚åˆä¸å¦ã€‚' },
                { id: 3, title: '2023 å¹´åº¦æ€»ç»“ï¼šåœ¨ä¸ç¡®å®šä¸­å¯»æ‰¾ç§©åº', summary: 'è¿™ä¸€å¹´ç»å†äº†è£å‘˜ã€ç‹¬ç«‹å¼€å‘ã€é•¿é€”æ—…è¡Œã€‚å›é¡¾è¿™ä¸€å¹´ï¼Œæˆ‘å­¦åˆ°äº†ä»€ä¹ˆï¼Ÿå…³äºç”Ÿæ´»ã€æŠ€æœ¯å’Œå¿ƒæ€ã€‚', date: '2023-12-31', categoryId: 'life', tags: ['Indie Hacker', 'Review'], content: '## æ‹¥æŠ±å˜åŒ–\n\n2023 å¹´æ˜¯åŠ¨è¡çš„ä¸€å¹´ã€‚AI çš„çˆ†å‘è®©å¾ˆå¤šç¨‹åºå‘˜æ„Ÿåˆ°ç„¦è™‘ã€‚ä½†æˆ‘è®¤ä¸ºï¼Œ**å”¯ä¸€ä¸å˜çš„å°±æ˜¯å˜åŒ–**ã€‚\n\n### å…³é”®æ•°æ®\n- å†™äº† 50 ç¯‡åšå®¢\n- å‘å¸ƒäº† 2 ä¸ªç‹¬ç«‹äº§å“\n- é˜…è¯»äº† 20 æœ¬ä¹¦\n\n> "ç§ä¸€æ£µæ ‘æœ€å¥½çš„æ—¶é—´æ˜¯åå¹´å‰ï¼Œå…¶æ¬¡æ˜¯ç°åœ¨ã€‚" \n\næ˜å¹´ï¼Œç»§ç»­å‰è¡Œã€‚' },
                { id: 4, title: 'ä¸œäº¬æ—…è¡Œæ¸¸è®°ï¼šæ¶©è°·çš„å¤œä¸é•°ä»“çš„æµ·', summary: 'ä¸€åœºè¯´èµ°å°±èµ°çš„æ—…è¡Œã€‚ä»ç¹åçš„éƒ½å¸‚åˆ°é™è°§çš„æµ·è¾¹ï¼Œç”¨é•œå¤´è®°å½•ä¸‹æ—¥æœ¬ç‹¬ç‰¹çš„è¡—å¤´ç¾å­¦ã€‚', date: '2023-11-12', categoryId: 'life', tags: ['Travel', 'Photography', 'Japan'], content: '## æ¶©è°·åå­—è·¯å£\n\nå½“ç»¿ç¯äº®èµ·ï¼Œæˆåƒä¸Šä¸‡çš„äººæ½®æ¶ŒåŠ¨ï¼Œé‚£ä¸€åˆ»ä»¿ä½›ç½®èº«äºç”µå½±åœºæ™¯ä¹‹ä¸­ã€‚éœ“è™¹ç¯é—ªçƒï¼Œå±•ç¤ºç€è¿™ä¸ªåŸå¸‚çš„æ´»åŠ›ã€‚\n\n![Tokyo](https://images.unsplash.com/photo-1503899036084-c55cdd92da26?auto=format&fit=crop&q=80&w=1000)\n\n### é•°ä»“é«˜æ ¡å‰\n\nä¹˜åæ±Ÿä¹‹ç”µï¼Œçœ‹ç€æµ·å¹³é¢çš„è½æ—¥ï¼Œè€³è¾¹ä»¿ä½›å“èµ·äº†çŒç¯®é«˜æ‰‹çš„ BGMã€‚é‚£æ˜¯é’æ˜¥çš„å‘³é“ã€‚' },
                { id: 5, title: 'ã€Šé»‘å®¢ä¸ç”»å®¶ã€‹è¯»åæ„Ÿ', summary: 'ä¿ç½—Â·æ ¼é›·å„å§†çš„ç»å…¸ä¹‹ä½œã€‚ç¼–ç¨‹ä¸ä»…ä»…æ˜¯å·¥ç¨‹ï¼Œæ›´æ˜¯ä¸€ç§è‰ºæœ¯åˆ›ä½œã€‚ä¸ºä»€ä¹ˆé»‘å®¢ä¹Ÿæ˜¯ç”»å®¶ï¼Ÿ', date: '2023-09-20', categoryId: 'reading', tags: ['Review', 'Indie Hacker'], content: '## åˆ›é€ è€…çš„å…±æ€§\n\nä¹¦ä¸­æå‡ºä¸€ä¸ªæœ‰è¶£çš„è§‚ç‚¹ï¼š**é»‘å®¢ï¼ˆHackerï¼‰ä¸ç”»å®¶ï¼ˆPainterï¼‰éƒ½æ˜¯åˆ›é€ è€…**ã€‚æˆ‘ä»¬éƒ½æ˜¯ä»é›¶å¼€å§‹ï¼Œåœ¨ä¸€å¼ ç™½çº¸ï¼ˆæˆ–ç©ºæ–‡ä»¶ï¼‰ä¸Šæ„å»ºä¸–ç•Œã€‚\n\n> å¥½çš„è®¾è®¡æ˜¯ç®€å•çš„è®¾è®¡ã€‚\n\nè¿™ç‚¹å¯¹äº UI è®¾è®¡å’Œä»£ç æ¶æ„åŒæ ·é€‚ç”¨ã€‚æˆ‘ä»¬è¦è¿½æ±‚çš„ä¸ä»…ä»…æ˜¯åŠŸèƒ½å®ç°ï¼Œè¿˜æœ‰ä»£ç çš„ç¾æ„Ÿå’Œç®€æ´ã€‚' },
                { id: 6, title: 'æˆ‘çš„å’–å•¡å†²ç…®æŒ‡å—', summary: 'ä»æ‰‹å†²åˆ°æ„å¼ï¼Œå¦‚ä½•åœ¨å®¶åˆ¶ä½œä¸€æ¯å®Œç¾çš„å’–å•¡ï¼Ÿåˆ†äº«æˆ‘çš„è®¾å¤‡æ¸…å•å’Œå‚æ•°è°ƒæ•´å¿ƒå¾—ã€‚', date: '2024-01-10', categoryId: 'life', tags: ['Coffee', 'Life'], content: '## æ¯æ—¥ä»ªå¼æ„Ÿ\n\næ—©èµ·çš„ä¸€æ¯å’–å•¡ï¼Œæ˜¯æˆ‘å¼€å¯ä¸€å¤©çš„å¼€å…³ã€‚\n\n### æ‰‹å†²å‚æ•°\n- **ç²‰æ°´æ¯”**: 1:15\n- **æ°´æ¸©**: 92åº¦\n- **ç ”ç£¨åº¦**: ä¸­ç»†ç ”ç£¨\n\näº«å—æ°´æµä¸å’–å•¡ç²‰æ¥è§¦é‚£ä¸€åˆ»çš„é¦™æ°”çˆ†å‘ï¼Œè¿™æ˜¯ä¸€ç§å†¥æƒ³ã€‚' },
                { id: 7, title: 'æç®€ UI è®¾è®¡åŸåˆ™ï¼šå°‘å³æ˜¯å¤š', summary: 'å¦‚ä½•è¿ç”¨ç•™ç™½ã€æ’ç‰ˆå’Œè‰²å½©æ¥æå‡äº§å“çš„è´¨æ„Ÿï¼Ÿç»™ç¨‹åºå‘˜çš„ UI è®¾è®¡å…¥é—¨è¯¾ã€‚', date: '2023-08-05', categoryId: 'design', tags: ['UI', 'Minimalism', 'CSS'], content: '## Less is More\n\n**ç•™ç™½ï¼ˆWhitespaceï¼‰**ä¸æ˜¯æµªè´¹ç©ºé—´ï¼Œå®ƒæ˜¯è®¾è®¡å‘¼å¸çš„çª—å£ã€‚\n\n1. **å±‚çº§**: é€šè¿‡å­—ä½“å¤§å°å’Œç²—ç»†åŒºåˆ†é‡ç‚¹ã€‚\n2. **å¯¹é½**: åƒç´ çº§çš„å¯¹é½èƒ½å¸¦æ¥ç§©åºæ„Ÿã€‚\n3. **è‰²å½©**: å…¨å±€ä¸è¶…è¿‡ä¸‰ç§ä¸»è‰²ã€‚\n\nä¸è¦å®³æ€•ç©ºç™½ï¼Œå®ƒæ˜¯é«˜çº§æ„Ÿçš„æ¥æºã€‚' },
                { id: 8, title: 'React Hooks æœ€ä½³å®è·µ', summary: 'é¿å…é—­åŒ…é™·é˜±ï¼Œä¼˜åŒ–æ¸²æŸ“æ€§èƒ½ã€‚æ·±å…¥æ¢è®¨ useCallback å’Œ useMemo çš„æ­£ç¡®ä½¿ç”¨åœºæ™¯ã€‚', date: '2024-01-25', categoryId: 'tech', tags: ['React', 'JavaScript'], content: '## ä¾èµ–æ•°ç»„çš„è°è¨€\n\nå¾ˆå¤š bug éƒ½æºäº `useEffect` çš„ä¾èµ–é¡¹æ²¡æœ‰å†™å…¨ã€‚ä½¿ç”¨ ESLint æ’ä»¶æ˜¯å¿…é¡»çš„ã€‚\n\n### è‡ªå®šä¹‰ Hooks\n\nå°†é€»è¾‘æŠ½ç¦»æˆ `useUser` æˆ– `useWindowSize`ï¼Œå¯ä»¥è®©ç»„ä»¶ä»£ç ä¿æŒå¹²å‡€çº¯ç²¹ã€‚\n\n```jsx\nconst { data, loading } = useFetch("/api/data");\nif (loading) return <Spinner />;\n```\n' }
            ],
            friends: [
                { name: 'Evan You', avatar: 'EY', desc: 'Creator of Vue.js', url: '#' },
                { name: 'Dan Abramov', avatar: 'DA', desc: 'React Core Team', url: '#' },
                { name: 'Anthony Fu', avatar: 'AF', desc: 'Vue/Vite Core Team', url: '#' },
                { name: 'Lee Robinson', avatar: 'LR', desc: 'VP at Vercel', url: '#' },
                { name: 'Josh Comeau', avatar: 'JC', desc: 'CSS Wizard', url: '#' },
                { name: 'Sarah Drasner', avatar: 'SD', desc: 'Engineering Manager', url: '#' },
                { name: 'Addy Osmani', avatar: 'AO', desc: 'Chrome Engineering', url: '#' },
                { name: 'Sindre Sorhus', avatar: 'SS', desc: 'Open Source Legend', url: '#' }
            ],
            aboutContent: `## ä½ å¥½ï¼Œæˆ‘æ˜¯ DevExpert ğŸ‘‹\n\nä¸€åè¿½æ±‚å®Œç¾çš„å‰ç«¯å·¥ç¨‹å¸ˆã€‚æˆ‘ç›¸ä¿¡ä»£ç å¦‚è¯—ï¼Œè®¾è®¡å¦‚ç”»ã€‚\n\n### ğŸ›  æŠ€æœ¯æ ˆ\n\n- **Core**: JavaScript (ES6+), TypeScript, HTML5, CSS3\n- **Frameworks**: Vue 3, React, Next.js, Tailwind CSS\n- **Tools**: VS Code, Figma, Docker, Git\n\n### ğŸ“® è”ç³»æˆ‘\n\n- **Email**: hi@devexpert.com\n- **Github**: @devexpert\n\n> "Stay hungry, stay foolish."`
        };

        // --- 2. COMPONENTS ---
        const formatDate = (d) => new Date(d).toLocaleDateString('zh-CN', { year: 'numeric', month: '2-digit', day: '2-digit' });
        const getParams = () => Object.fromEntries(new URLSearchParams(window.location.hash.split('?')[1]));
        const estimateReadingTime = (text) => Math.ceil(text.length / 400); 

        // ä¿®å¤ï¼šç¡®ä¿ PostCard æ•´ä¸ªå¡ç‰‡å¯ç‚¹å‡»ï¼Œä¸” onclick è°ƒç”¨æ˜¯å…¨å±€ router
        const PostCard = (post) => {
            const cat = DB.categories.find(c => c.id === post.categoryId);
            return `
                <article onclick="router.push('article?id=${post.id}')" 
                    class="group bg-white dark:bg-gray-900 rounded-lg p-5 border border-gray-100 dark:border-gray-800 hover:border-blue-200 dark:hover:border-blue-800 hover:shadow-md transition-all cursor-pointer mb-4">
                    <div class="flex items-center gap-2 mb-2 text-xs text-gray-500 dark:text-gray-400">
                        <span class="text-blue-600 dark:text-blue-400 font-medium">${cat.emoji} ${cat.name}</span>
                        <span>â€¢</span>
                        <time>${formatDate(post.date)}</time>
                    </div>
                    <h3 class="text-lg font-bold mb-2 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors">${post.title}</h3>
                    <p class="text-sm text-gray-600 dark:text-gray-400 line-clamp-2 leading-relaxed">${post.summary}</p>
                </article>
            `;
        };

        const Sidebar = () => `
            <div class="space-y-6">
                <!-- Profile -->
                <div class="bg-white dark:bg-gray-900 p-5 rounded-lg border border-gray-100 dark:border-gray-800">
                    <div class="flex flex-col items-center text-center">
                        <div class="w-16 h-16 bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-300 rounded-full flex items-center justify-center font-bold text-xl mb-3">D</div>
                        <h3 class="font-bold text-gray-900 dark:text-white">DevExpert</h3>
                        <p class="text-xs text-gray-500 mb-4">Frontend Developer</p>
                        <p class="text-xs text-gray-600 dark:text-gray-400 mb-4 leading-relaxed">è¿½æ±‚æè‡´ç”¨æˆ·ä½“éªŒï¼Œåˆ†äº«æŠ€æœ¯ä¸ç”Ÿæ´»ã€‚</p>
                        <div class="flex gap-2 w-full">
                            <a href="#about" class="flex-1 py-1.5 text-xs font-medium bg-gray-50 dark:bg-gray-800 rounded hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">å…³äºæˆ‘</a>
                            <a href="https://github.com/devexpert" target="_blank" rel="noopener noreferrer" class="flex-1 py-1.5 text-xs font-medium bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 rounded hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors">Github</a>
                        </div>
                    </div>
                </div>
                <!-- Tags -->
                <div class="bg-white dark:bg-gray-900 p-5 rounded-lg border border-gray-100 dark:border-gray-800">
                    <h4 class="font-bold text-xs mb-3 text-gray-900 dark:text-white uppercase tracking-wider">çƒ­é—¨æ ‡ç­¾</h4>
                    <div class="flex flex-wrap gap-2">
                        ${DB.tags.slice(0, 8).map(t => `<button onclick="router.push('tags?name=${t}')" class="text-xs px-2 py-1 bg-gray-50 dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-300 rounded transition-colors">#${t}</button>`).join('')}
                    </div>
                </div>
                <!-- Realtime -->
                <div class="bg-white dark:bg-gray-900 p-5 rounded-lg border border-gray-100 dark:border-gray-800">
                    <div class="flex items-center justify-between">
                        <h4 class="font-bold text-xs text-gray-900 dark:text-white uppercase tracking-wider">å®æ—¶ä¿¡æ¯</h4>
                        <span id="realtime-tz" class="text-[10px] text-gray-400"></span>
                    </div>
                    <div class="mt-3">
                        <div id="realtime-time" class="text-2xl font-bold text-gray-900 dark:text-white tabular-nums">--:--:--</div>
                        <div id="realtime-date" class="mt-1 text-xs text-gray-500 dark:text-gray-400">----</div>
                    </div>
                </div>
                <!-- Weather -->
                <div class="bg-white dark:bg-gray-900 p-5 rounded-lg border border-gray-100 dark:border-gray-800">
                    <div class="flex items-center justify-between gap-3">
                        <h4 class="font-bold text-xs text-gray-900 dark:text-white uppercase tracking-wider">å¤©æ°”</h4>
                        <button id="weather-refresh" class="text-[10px] px-2 py-1 rounded bg-gray-50 dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-300 transition-colors">åˆ·æ–°</button>
                    </div>
                    <div class="mt-3 flex gap-2">
                        <input id="weather-city-input" type="text" placeholder="è¾“å…¥åŸå¸‚ï¼Œå¦‚ åŒ—äº¬" class="flex-1 text-xs px-3 py-2 rounded-lg border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-950/40 outline-none focus:ring-2 focus:ring-blue-500/30">
                        <button id="weather-search" class="text-xs px-3 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition-colors">æŸ¥è¯¢</button>
                    </div>
                    <div class="mt-4 flex items-start justify-between gap-3">
                        <div>
                            <div id="weather-location" class="text-xs font-medium text-gray-900 dark:text-white">â€”</div>
                            <div id="weather-desc" class="mt-1 text-xs text-gray-500 dark:text-gray-400">â€”</div>
                            <div id="weather-meta" class="mt-1 text-[10px] text-gray-400">â€”</div>
                        </div>
                        <div id="weather-temp" class="text-2xl font-bold text-gray-900 dark:text-white tabular-nums">--Â°</div>
                    </div>
                    <div id="weather-status" class="mt-3 text-[10px] text-gray-400">å¯æŸ¥è¯¢åŸå¸‚å¤©æ°”ï¼›å®šä½éœ€åœ¨ http://localhost æˆ– https ç¯å¢ƒ</div>
                    <div class="mt-3">
                        <button id="weather-geolocate" class="w-full text-xs px-3 py-2 rounded-lg border border-gray-200 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors">ä½¿ç”¨å®šä½</button>
                    </div>
                </div>
            </div>
        `;

        // --- 3. VIEWS ---
        const Views = {
            home: () => {
                const posts = [...DB.posts].sort((a,b) => new Date(b.date) - new Date(a.date));
                // ä¿®å¤ï¼šå¸ƒå±€è°ƒæ•´ 2:1 (col-span-2 vs col-span-1)ï¼Œgap-6ï¼Œå¯¹é½é¡¶éƒ¨
                return `
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 fade-in items-start">
                        <div class="md:col-span-2 space-y-4">
                            ${posts.map(PostCard).join('')}
                        </div>
                        <div class="hidden md:block md:col-span-1 sticky top-24">
                            ${Sidebar()}
                        </div>
                    </div>
                `;
            },

            categories: () => {
                const currentId = getParams().id;
                const gridHtml = `
                    <div class="text-center mb-8 fade-in">
                        <h1 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">æ–‡ç« åˆ†ç±»</h1>
                        <p class="text-gray-500 dark:text-gray-400 text-sm">æ¢ç´¢æŠ€æœ¯ä¸ç”Ÿæ´»çš„ä¸åŒç»´åº¦</p>
                    </div>
                    <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 mb-10 fade-in">
                        ${DB.categories.map(cat => {
                            const isActive = currentId === cat.id;
                            const activeClass = isActive
                                ? 'bg-blue-50 text-gray-900 border-blue-300 ring-1 ring-blue-200 ring-offset-2 ring-offset-gray-50 dark:ring-offset-gray-950 dark:bg-blue-900/20 dark:text-white dark:border-blue-700'
                                : 'bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-800 hover:border-blue-300 dark:hover:border-blue-700 hover:shadow-md';
                            const count = DB.posts.filter(p => p.categoryId === cat.id).length;
                            return `
                                <div onclick="router.push('categories?id=${cat.id}')" 
                                     class="${activeClass} p-4 rounded-lg border cursor-pointer transition-all duration-200 flex flex-col items-center text-center justify-center min-h-[140px] group">
                                    <div class="text-3xl mb-2">${cat.emoji}</div>
                                    <div class="font-bold text-sm mb-1">${cat.name}</div>
                                    <div class="text-xs opacity-70 mb-2 line-clamp-1">${cat.desc}</div>
                                    <div class="text-xs font-mono opacity-50 bg-black/5 dark:bg-white/10 px-2 py-0.5 rounded-full">${count} ç¯‡æ–‡ç« </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
                let listHtml = '';
                if (currentId) {
                    const filtered = DB.posts.filter(p => p.categoryId === currentId);
                    listHtml = `<div class="fade-in border-t border-gray-100 dark:border-gray-800 pt-8">
                        <div class="text-sm text-gray-400 mb-6">ç›¸å…³æ–‡ç« </div>
                        ${filtered.length ? filtered.map(PostCard).join('') : '<div class="text-center py-10">æš‚æ— æ–‡ç« </div>'}
                    </div>`;
                }
                return gridHtml + listHtml;
            },

            tags: () => {
                const currentTag = getParams().name;
                const cloudHtml = `
                    <div class="text-center mb-8 fade-in">
                        <h1 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">æ ‡ç­¾äº‘</h1>
                        <p class="text-gray-500 dark:text-gray-400 text-sm">é€šè¿‡å…³é”®è¯è¿æ¥ç¢ç‰‡åŒ–çš„æ€è€ƒ</p>
                    </div>
                    <div class="flex flex-wrap justify-center gap-2 mb-10 mx-auto fade-in">
                        ${DB.tags.map(tag => {
                            const isActive = currentTag === tag;
                            const activeClass = isActive
                                ? 'bg-blue-50 text-blue-700 border-blue-300 shadow-sm scale-105 dark:bg-blue-900/20 dark:text-blue-300 dark:border-blue-700'
                                : 'bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-800 text-gray-600 dark:text-gray-400 hover:border-blue-400 dark:hover:border-blue-700 hover:text-blue-500';
                            return `<button onclick="router.push('tags?name=${tag}')" class="${activeClass} px-4 py-2 rounded-lg border text-sm font-medium transition-all">${tag}</button>`;
                        }).join('')}
                    </div>
                `;
                let listHtml = '';
                if (currentTag) {
                    const filtered = DB.posts.filter(p => p.tags.includes(currentTag));
                    listHtml = `<div class="fade-in border-t border-gray-100 dark:border-gray-800 pt-8">
                        <div class="text-sm text-gray-400 mb-6">åŒ…å« <span class="text-blue-500 font-bold">#${currentTag}</span> çš„æ–‡ç« </div>
                        ${filtered.length ? filtered.map(PostCard).join('') : '<div class="text-center py-10">æš‚æ— æ–‡ç« </div>'}
                    </div>`;
                }
                return cloudHtml + listHtml;
            },

            links: () => `
                <div class="text-center mb-10 fade-in">
                    <h1 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">å‹æƒ…é“¾æ¥</h1>
                </div>
                <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 fade-in">
                    ${DB.friends.map(f => `
                        <a href="${f.url}" class="block bg-white dark:bg-gray-900 p-6 rounded-lg border border-gray-200 dark:border-gray-800 hover:border-blue-400 hover:-translate-y-1 transition-all text-center group">
                            <div class="w-12 h-12 mx-auto mb-3 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center text-xs font-bold">${f.avatar}</div>
                            <div class="font-bold text-sm text-gray-900 dark:text-white mb-1">${f.name}</div>
                            <div class="text-xs text-gray-400 truncate">${f.desc}</div>
                        </a>
                    `).join('')}
                </div>
            `,

            about: () => {
                const postCount = DB.posts.length;
                const categoryCount = DB.categories.length;
                const tagCount = DB.tags.length;
                const latest = [...DB.posts].sort((a,b) => new Date(b.date) - new Date(a.date))[0];

                return `
                    <div class="space-y-6 fade-in">
                        <section class="bg-white dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-800 p-6 sm:p-10">
                            <div class="flex flex-col sm:flex-row sm:items-center gap-6">
                                <div class="mx-auto sm:mx-0 w-20 h-20 bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-300 rounded-full flex items-center justify-center font-bold text-2xl">D</div>
                                <div class="flex-1 text-center sm:text-left">
                                    <div class="text-xs uppercase tracking-wider text-gray-400 dark:text-gray-500">About</div>
                                    <h1 class="text-3xl font-bold mt-2 text-gray-900 dark:text-white">å…³äº</h1>
                                    <p class="mt-3 text-sm text-gray-600 dark:text-gray-400 leading-relaxed">è¿™é‡Œæ˜¯ä¸ªäººä»‹ç»ä¸ç«™ç‚¹ä¿¡æ¯é¡µã€‚ä½ å¯ä»¥åœ¨ä¸‹æ–¹ç”¨ Markdown ç»´æŠ¤æ›´å®Œæ•´çš„è‡ªæˆ‘ä»‹ç»ã€æŠ€æœ¯æ ˆä¸è”ç³»æ–¹å¼ã€‚</p>
                                    <div class="mt-4 flex flex-wrap gap-2 justify-center sm:justify-start">
                                        <a href="mailto:hi@devexpert.com" class="px-3 py-2 rounded-lg border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900 hover:bg-gray-50 dark:hover:bg-gray-800 text-sm font-medium transition-colors">é‚®ç®±è”ç³»</a>
                                        <a href="https://github.com/devexpert" target="_blank" rel="noopener noreferrer" class="px-3 py-2 rounded-lg border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900 hover:bg-gray-50 dark:hover:bg-gray-800 text-sm font-medium transition-colors">GitHub</a>
                                        <a href="#home" onclick="router.push('home')" class="px-3 py-2 rounded-lg border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900 hover:bg-gray-50 dark:hover:bg-gray-800 text-sm font-medium transition-colors">è¿”å›é¦–é¡µ</a>
                                    </div>
                                </div>
                                <div class="grid grid-cols-3 gap-3 text-center w-full sm:w-auto">
                                    <div class="rounded-lg border border-gray-100 dark:border-gray-800 bg-gray-50 dark:bg-gray-950/40 px-4 py-3">
                                        <div class="text-lg font-bold text-gray-900 dark:text-white">${postCount}</div>
                                        <div class="text-xs text-gray-500 dark:text-gray-400">æ–‡ç« </div>
                                    </div>
                                    <div class="rounded-lg border border-gray-100 dark:border-gray-800 bg-gray-50 dark:bg-gray-950/40 px-4 py-3">
                                        <div class="text-lg font-bold text-gray-900 dark:text-white">${categoryCount}</div>
                                        <div class="text-xs text-gray-500 dark:text-gray-400">åˆ†ç±»</div>
                                    </div>
                                    <div class="rounded-lg border border-gray-100 dark:border-gray-800 bg-gray-50 dark:bg-gray-950/40 px-4 py-3">
                                        <div class="text-lg font-bold text-gray-900 dark:text-white">${tagCount}</div>
                                        <div class="text-xs text-gray-500 dark:text-gray-400">æ ‡ç­¾</div>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
                            <aside class="lg:col-span-4 space-y-6">
                                <div class="bg-white dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-800 p-6">
                                    <h3 class="font-bold text-sm text-gray-900 dark:text-white uppercase tracking-wider">ç«™ç‚¹ä¿¡æ¯</h3>
                                    <div class="mt-4 space-y-3 text-sm text-gray-600 dark:text-gray-400">
                                        <div class="flex items-center justify-between gap-3">
                                            <span class="text-gray-500 dark:text-gray-500">æœ€æ–°æ–‡ç« </span>
                                            <span class="font-medium text-gray-900 dark:text-gray-200 text-right">${latest ? latest.title : 'â€”'}</span>
                                        </div>
                                        <div class="flex items-center justify-between gap-3">
                                            <span class="text-gray-500 dark:text-gray-500">æ›´æ–°æ—¥æœŸ</span>
                                            <span class="font-medium text-gray-900 dark:text-gray-200">${latest ? formatDate(latest.date) : 'â€”'}</span>
                                        </div>
                                    </div>
                                    ${latest ? `<button onclick="router.push('article?id=${latest.id}')" class="mt-4 w-full px-3 py-2 rounded-lg bg-blue-600 text-white text-sm font-medium hover:bg-blue-700 transition-colors">é˜…è¯»æœ€æ–°æ–‡ç« </button>` : ''}
                                </div>

                                <div class="bg-white dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-800 p-6">
                                    <h3 class="font-bold text-sm text-gray-900 dark:text-white uppercase tracking-wider">å¿«é€Ÿå¯¼èˆª</h3>
                                    <div class="mt-4 grid grid-cols-2 gap-2">
                                        <button onclick="router.push('home')" class="px-3 py-2 rounded-lg border border-gray-200 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800 text-sm transition-colors">é¦–é¡µ</button>
                                        <button onclick="router.push('categories')" class="px-3 py-2 rounded-lg border border-gray-200 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800 text-sm transition-colors">åˆ†ç±»</button>
                                        <button onclick="router.push('tags')" class="px-3 py-2 rounded-lg border border-gray-200 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800 text-sm transition-colors">æ ‡ç­¾</button>
                                        <button onclick="router.push('links')" class="px-3 py-2 rounded-lg border border-gray-200 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800 text-sm transition-colors">å‹é“¾</button>
                                    </div>
                                </div>
                            </aside>

                            <div class="lg:col-span-8">
                                <div class="bg-white dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-800 p-6 sm:p-10">
                                    <div class="prose dark:prose-invert max-w-none text-base sm:text-lg">
                                        ${marked.parse(DB.aboutContent)}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            },

            article: () => {
                const id = getParams().id;
                const post = DB.posts.find(p => p.id == id);
                if (!post) return `<div class="text-center py-20">æ–‡ç« æœªæ‰¾åˆ°</div>`;
                
                const toc = [];
                const lines = post.content.split('\n');
                lines.forEach(line => {
                    const h2 = line.match(/^##\s+(.*)/);
                    const h3 = line.match(/^###\s+(.*)/);
                    if (h2) toc.push({ text: h2[1], level: 2, id: slugify(h2[1]) });
                    if (h3) toc.push({ text: h3[1], level: 3, id: slugify(h3[1]) });
                });

                const readTime = estimateReadingTime(post.content);
                const orderedPosts = [...DB.posts].sort((a, b) => new Date(a.date) - new Date(b.date));
                const currentIndex = orderedPosts.findIndex(p => p.id == post.id);
                const prevPost = currentIndex > 0 ? orderedPosts[currentIndex - 1] : null;
                const nextPost = currentIndex >= 0 && currentIndex < orderedPosts.length - 1 ? orderedPosts[currentIndex + 1] : null;

                return `
                    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 relative fade-in">
                        <!-- Content -->
                        <article id="article-root" class="lg:col-span-9">
                            <div class="bg-white dark:bg-gray-900 p-6 sm:p-10 rounded-lg border border-gray-200 dark:border-gray-800">
                            <header class="mb-8 text-center">
                                <h1 class="text-3xl font-bold mb-4 text-gray-900 dark:text-white leading-tight">${post.title}</h1>
                                <div class="flex flex-wrap items-center justify-center gap-4 text-sm text-gray-500 dark:text-gray-400 mb-4">
                                    <span>ğŸ“… ${formatDate(post.date)}</span>
                                    <span>â±ï¸ çº¦ ${readTime} åˆ†é’Ÿé˜…è¯»</span>
                                </div>
                                <div class="flex flex-wrap justify-center gap-2">
                                    ${post.tags.map(t => `<span onclick="router.push('tags?name=${t}')" class="cursor-pointer px-3 py-1 bg-gray-100 dark:bg-gray-800 rounded-full text-xs hover:bg-blue-50 dark:hover:bg-blue-900/20 hover:text-blue-600 transition-colors"># ${t}</span>`).join('')}
                                </div>
                            </header>
                            <div class="prose dark:prose-invert max-w-none border-t border-gray-100 dark:border-gray-800 pt-8">
                                ${marked.parse(post.content)}
                            </div>
                            <nav class="mt-10 pt-8 border-t border-gray-100 dark:border-gray-800 grid grid-cols-1 sm:grid-cols-2 gap-4">
                                ${prevPost ? `
                                    <button onclick="router.push('article?id=${prevPost.id}')" class="group text-left p-4 rounded-lg border border-gray-200 dark:border-gray-800 hover:border-blue-300 dark:hover:border-blue-700 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors">
                                        <div class="text-xs text-gray-500 dark:text-gray-400 mb-1">ä¸Šä¸€ç¯‡</div>
                                        <div class="text-sm font-semibold text-gray-900 dark:text-white group-hover:text-blue-600 dark:group-hover:text-blue-400 line-clamp-2">${prevPost.title}</div>
                                    </button>
                                ` : `<div></div>`}
                                ${nextPost ? `
                                    <button onclick="router.push('article?id=${nextPost.id}')" class="group text-right p-4 rounded-lg border border-gray-200 dark:border-gray-800 hover:border-blue-300 dark:hover:border-blue-700 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors">
                                        <div class="text-xs text-gray-500 dark:text-gray-400 mb-1">ä¸‹ä¸€ç¯‡</div>
                                        <div class="text-sm font-semibold text-gray-900 dark:text-white group-hover:text-blue-600 dark:group-hover:text-blue-400 line-clamp-2">${nextPost.title}</div>
                                    </button>
                                ` : `<div></div>`}
                            </nav>
                            </div>
                        </article>
                        
                        <!-- TOC Sidebar -->
                        <aside class="hidden lg:block lg:col-span-3">
                            <div class="sticky top-24">
                                <h4 class="font-bold text-sm text-gray-900 dark:text-white mb-4 uppercase tracking-wider pl-4">ç›®å½•</h4>
                                <nav id="toc" class="space-y-1 border-l border-gray-200 dark:border-gray-800">
                                    ${toc.map(item => `
                                        <a href="#${item.id}" onclick="event.preventDefault(); document.getElementById('${item.id}')?.scrollIntoView({ behavior: 'smooth', block: 'start' });" class="toc-link block text-xs py-1.5 hover:text-blue-500 transition-colors border-l-2 border-transparent pl-4 ${item.level === 3 ? 'ml-2 text-gray-400' : 'text-gray-500 dark:text-gray-400'}" data-id="${item.id}">
                                            ${item.text}
                                        </a>
                                    `).join('')}
                                </nav>
                            </div>
                        </aside>
                    </div>
                `;
            }
        };

        // --- 4. CORE LOGIC ---
        const viewCleanupManager = (() => {
            let cleanups = [];
            return {
                add(fn) {
                    if (typeof fn === 'function') cleanups.push(fn);
                },
                runAll() {
                    cleanups.forEach(fn => {
                        try { fn(); } catch (e) {}
                    });
                    cleanups = [];
                }
            };
        })();

        const router = {
            init() {
                window.addEventListener('hashchange', () => this.render());
                window.addEventListener('load', () => this.render());
            },
            render() {
                const rawHash = window.location.hash.split('?')[0] || '#home';
                const viewName = rawHash.slice(1);
                viewCleanupManager.runAll();
                
                document.querySelectorAll('.nav-item').forEach(el => {
                    const href = el.getAttribute('href');
                    if (href === rawHash) el.classList.add('text-black', 'dark:text-white', 'font-bold');
                    else el.classList.remove('text-black', 'dark:text-white', 'font-bold');
                });

                window.scrollTo(0,0);
                
                // ä¿®å¤ï¼šå¦‚æœ viewName å­˜åœ¨åˆ™æ¸²æŸ“ï¼Œå¦åˆ™å›é€€åˆ° home
                if (Views[viewName]) {
                    document.getElementById('app').innerHTML = Views[viewName]();
                } else {
                    document.getElementById('app').innerHTML = Views.home();
                }

                setTimeout(() => {
                    if (viewName === 'article') {
                        if (window.hljs) hljs.highlightAll();
                        viewCleanupManager.add(initTOC());
                        viewCleanupManager.add(initReadingProgress());
                    }
                    if (viewName === 'home') {
                        viewCleanupManager.add(initRealtimeCard());
                        viewCleanupManager.add(initWeatherCard());
                    }
                }, 0);
            },
            push(path) { window.location.hash = path; }
        };

        const searchManager = {
            init() {
                const modal = document.getElementById('search-modal');
                const btn = document.getElementById('search-btn');
                const input = document.getElementById('search-input');
                const results = document.getElementById('search-results');
                btn.onclick = () => { modal.classList.remove('hidden'); input.focus(); };
                document.addEventListener('keydown', (e) => { if (e.key === 'Escape') this.close(); });
                input.addEventListener('input', (e) => {
                    const q = e.target.value.toLowerCase().trim();
                    if (!q) { results.innerHTML = ''; return; }
                    const matches = DB.posts.filter(p => p.title.toLowerCase().includes(q) || p.summary.toLowerCase().includes(q));
                    results.innerHTML = matches.length ? matches.map(p => `
                        <div onclick="router.push('article?id=${p.id}'); searchManager.close()" class="p-3 hover:bg-gray-50 dark:hover:bg-gray-800 rounded cursor-pointer border-b border-gray-50 dark:border-gray-800 last:border-0">
                            <div class="text-sm font-bold text-gray-800 dark:text-gray-200">${p.title}</div>
                        </div>`).join('') : '<div class="text-center py-4 text-gray-400 text-xs">æ— ç»“æœ</div>';
                });
            },
            close() { document.getElementById('search-modal').classList.add('hidden'); document.getElementById('search-input').value = ''; }
        };

        function initTOC() {
            const toc = document.getElementById('toc');
            if (!toc) return null;

            const links = Array.from(toc.querySelectorAll('.toc-link'));
            if (!links.length) return null;

            const linkById = new Map(links.map(l => [l.dataset.id, l]));
            const headings = Array.from(document.querySelectorAll('.prose h2, .prose h3'))
                .filter(h => h.id && linkById.has(h.id));
            if (!headings.length) return null;

            let activeId = null;
            const setActive = (id) => {
                if (!id || id === activeId) return;
                activeId = id;
                links.forEach(link => link.classList.toggle('active', link.dataset.id === id));
            };

            const topOffset = 96;
            const computeActiveId = () => {
                let currentId = headings[0].id;
                for (const heading of headings) {
                    if (heading.getBoundingClientRect().top <= topOffset) currentId = heading.id;
                    else break;
                }
                return currentId;
            };

            let rafId = 0;
            const onScroll = () => {
                if (rafId) return;
                rafId = requestAnimationFrame(() => {
                    rafId = 0;
                    setActive(computeActiveId());
                });
            };

            setActive(computeActiveId());
            window.addEventListener('scroll', onScroll, { passive: true });
            window.addEventListener('resize', onScroll);

            return () => {
                window.removeEventListener('scroll', onScroll);
                window.removeEventListener('resize', onScroll);
                if (rafId) cancelAnimationFrame(rafId);
            };
        }

        function initReadingProgress() {
            const bar = document.getElementById('reading-progress');
            if (!bar) return null;

            bar.classList.remove('hidden');

            const article = document.getElementById('article-root');
            if (!article) {
                bar.classList.add('hidden');
                return null;
            }

            const update = () => {
                const scrollY = window.scrollY || window.pageYOffset || 0;
                const start = article.getBoundingClientRect().top + scrollY;
                const end = start + article.scrollHeight - window.innerHeight;
                const raw = end > start ? (scrollY - start) / (end - start) : 0;
                const progress = Math.max(0, Math.min(1, raw));
                bar.style.transform = `scaleX(${progress})`;
            };

            let rafId = 0;
            const onScroll = () => {
                if (rafId) return;
                rafId = requestAnimationFrame(() => {
                    rafId = 0;
                    update();
                });
            };

            update();
            window.addEventListener('scroll', onScroll, { passive: true });
            window.addEventListener('resize', onScroll);

            return () => {
                window.removeEventListener('scroll', onScroll);
                window.removeEventListener('resize', onScroll);
                if (rafId) cancelAnimationFrame(rafId);
                bar.style.transform = 'scaleX(0)';
                bar.classList.add('hidden');
            };
        }

        function initRealtimeCard() {
            const timeEl = document.getElementById('realtime-time');
            const dateEl = document.getElementById('realtime-date');
            const tzEl = document.getElementById('realtime-tz');
            if (!timeEl || !dateEl) return null;

            const pad2 = (n) => String(n).padStart(2, '0');
            const offsetMin = -new Date().getTimezoneOffset();
            const sign = offsetMin >= 0 ? '+' : '-';
            const offsetAbs = Math.abs(offsetMin);
            const offsetStr = `UTC${sign}${pad2(Math.floor(offsetAbs / 60))}:${pad2(offsetAbs % 60)}`;
            const tzName = Intl.DateTimeFormat().resolvedOptions().timeZone || '';
            if (tzEl) tzEl.textContent = tzName ? `${tzName} Â· ${offsetStr}` : offsetStr;

            const timeFmt = new Intl.DateTimeFormat('zh-CN', { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false });
            const dateFmt = new Intl.DateTimeFormat('zh-CN', { year: 'numeric', month: '2-digit', day: '2-digit', weekday: 'short' });

            const update = () => {
                const now = new Date();
                timeEl.textContent = timeFmt.format(now);
                dateEl.textContent = dateFmt.format(now);
            };

            update();
            const intervalId = window.setInterval(update, 1000);
            return () => window.clearInterval(intervalId);
        }

        function initWeatherCard() {
            const input = document.getElementById('weather-city-input');
            const searchBtn = document.getElementById('weather-search');
            const refreshBtn = document.getElementById('weather-refresh');
            const geoBtn = document.getElementById('weather-geolocate');
            const locationEl = document.getElementById('weather-location');
            const descEl = document.getElementById('weather-desc');
            const metaEl = document.getElementById('weather-meta');
            const tempEl = document.getElementById('weather-temp');
            const statusEl = document.getElementById('weather-status');

            if (!input || !searchBtn || !refreshBtn || !geoBtn || !locationEl || !descEl || !metaEl || !tempEl || !statusEl) return null;

            const setStatus = (text) => { statusEl.textContent = text; };
            const setLoading = (isLoading) => {
                searchBtn.disabled = isLoading;
                refreshBtn.disabled = isLoading;
                geoBtn.disabled = isLoading;
                searchBtn.classList.toggle('opacity-60', isLoading);
                refreshBtn.classList.toggle('opacity-60', isLoading);
                geoBtn.classList.toggle('opacity-60', isLoading);
            };

            const weatherCodeText = (code) => {
                const map = {
                    0: 'æ™´',
                    1: 'å¤§éƒ¨æ™´æœ—',
                    2: 'å¤šäº‘',
                    3: 'é˜´',
                    45: 'é›¾',
                    48: 'é›¾ï¼ˆæ²‰ç§¯ï¼‰',
                    51: 'æ¯›æ¯›é›¨ï¼ˆå°ï¼‰',
                    53: 'æ¯›æ¯›é›¨ï¼ˆä¸­ï¼‰',
                    55: 'æ¯›æ¯›é›¨ï¼ˆå¤§ï¼‰',
                    56: 'å†»æ¯›æ¯›é›¨ï¼ˆå°ï¼‰',
                    57: 'å†»æ¯›æ¯›é›¨ï¼ˆå¤§ï¼‰',
                    61: 'å°é›¨',
                    63: 'ä¸­é›¨',
                    65: 'å¤§é›¨',
                    66: 'å†»é›¨ï¼ˆå°ï¼‰',
                    67: 'å†»é›¨ï¼ˆå¤§ï¼‰',
                    71: 'å°é›ª',
                    73: 'ä¸­é›ª',
                    75: 'å¤§é›ª',
                    77: 'é›ªç²’',
                    80: 'é˜µé›¨ï¼ˆå°ï¼‰',
                    81: 'é˜µé›¨ï¼ˆä¸­ï¼‰',
                    82: 'é˜µé›¨ï¼ˆå¤§ï¼‰',
                    85: 'é˜µé›ªï¼ˆå°ï¼‰',
                    86: 'é˜µé›ªï¼ˆå¤§ï¼‰',
                    95: 'é›·æš´',
                    96: 'é›·æš´ï¼ˆå†°é›¹ï¼‰',
                    99: 'å¼ºé›·æš´ï¼ˆå†°é›¹ï¼‰'
                };
                return map[code] || `å¤©æ°”ä»£ç  ${code}`;
            };

            const readLocation = () => {
                try { return JSON.parse(localStorage.getItem('weatherLocation') || 'null'); } catch (e) { return null; }
            };
            const writeLocation = (loc) => localStorage.setItem('weatherLocation', JSON.stringify(loc));
            const readCache = () => {
                try { return JSON.parse(localStorage.getItem('weatherCache') || 'null'); } catch (e) { return null; }
            };
            const writeCache = (cache) => localStorage.setItem('weatherCache', JSON.stringify(cache));
            const locationKey = (loc) => `${Number(loc.latitude).toFixed(2)},${Number(loc.longitude).toFixed(2)}`;

            let controller = null;
            let currentLoc = null;

            const fetchJson = async (url, signal) => {
                const res = await fetch(url, { signal });
                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                return res.json();
            };

            const renderWeather = (data, loc) => {
                const current = data?.current;
                if (!current) throw new Error('æ— æ•ˆçš„å¤©æ°”æ•°æ®');

                const temp = Math.round(current.temperature_2m);
                const feels = typeof current.apparent_temperature === 'number' ? Math.round(current.apparent_temperature) : null;
                const wind = typeof current.wind_speed_10m === 'number' ? Math.round(current.wind_speed_10m) : null;
                const code = current.weather_code;

                locationEl.textContent = loc.displayName || loc.name || 'â€”';
                tempEl.textContent = `${temp}Â°`;
                descEl.textContent = weatherCodeText(code);

                const parts = [];
                if (feels !== null) parts.push(`ä½“æ„Ÿ ${feels}Â°`);
                if (wind !== null) parts.push(`é£ ${wind} m/s`);
                const now = new Date();
                parts.push(`æ›´æ–°äº ${now.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' })}`);
                metaEl.textContent = parts.join(' Â· ');
            };

            const loadWeather = async (loc, opts = {}) => {
                const { force = false } = opts;
                currentLoc = loc;

                const key = locationKey(loc);
                const cache = readCache();
                const maxAgeMs = 15 * 60 * 1000;
                if (!force && cache && cache.key === key && Date.now() - cache.ts < maxAgeMs) {
                    try {
                        renderWeather(cache.data, loc);
                        setStatus('ä½¿ç”¨ç¼“å­˜æ•°æ®ï¼ˆ15 åˆ†é’Ÿå†…ï¼‰');
                        return;
                    } catch (e) {}
                }

                if (controller) controller.abort();
                controller = new AbortController();

                setLoading(true);
                setStatus('è·å–å¤©æ°”ä¸­â€¦');
                try {
                    const url = `https://api.open-meteo.com/v1/forecast?latitude=${encodeURIComponent(loc.latitude)}&longitude=${encodeURIComponent(loc.longitude)}&current=temperature_2m,apparent_temperature,weather_code,wind_speed_10m&timezone=auto`;
                    const data = await fetchJson(url, controller.signal);
                    renderWeather(data, loc);
                    writeCache({ key, ts: Date.now(), data });
                    setStatus('è·å–æˆåŠŸ');
                } catch (e) {
                    setStatus(`è·å–å¤±è´¥ï¼š${e?.message || 'æœªçŸ¥é”™è¯¯'}`);
                } finally {
                    setLoading(false);
                }
            };

            const resolveCity = async (name) => {
                if (controller) controller.abort();
                controller = new AbortController();

                const url = `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(name)}&count=1&language=zh&format=json`;
                const data = await fetchJson(url, controller.signal);
                const first = data?.results?.[0];
                if (!first) throw new Error('æœªæ‰¾åˆ°åŸå¸‚');

                const parts = [first.name, first.admin1, first.country].filter(Boolean);
                return {
                    name: first.name,
                    displayName: parts.join(' Â· '),
                    latitude: first.latitude,
                    longitude: first.longitude
                };
            };

            const onSearch = async () => {
                const name = String(input.value || '').trim();
                if (!name) {
                    setStatus('è¯·è¾“å…¥åŸå¸‚åï¼ˆä¾‹å¦‚ï¼šåŒ—äº¬ï¼‰');
                    return;
                }

                setLoading(true);
                setStatus('æŸ¥è¯¢åŸå¸‚ä¸­â€¦');
                try {
                    const loc = await resolveCity(name);
                    writeLocation(loc);
                    await loadWeather(loc, { force: true });
                } catch (e) {
                    setStatus(`æŸ¥è¯¢å¤±è´¥ï¼š${e?.message || 'æœªçŸ¥é”™è¯¯'}`);
                } finally {
                    setLoading(false);
                }
            };

            const onRefresh = async () => {
                if (currentLoc) return loadWeather(currentLoc, { force: true });
                return onSearch();
            };

            const onGeolocate = () => {
                if (!window.isSecureContext) {
                    setStatus('å®šä½éœ€è¦ https æˆ– http://localhost ç¯å¢ƒï¼ˆå»ºè®®ç”¨ py -m http.serverï¼‰');
                    return;
                }
                if (!navigator.geolocation) {
                    setStatus('å½“å‰æµè§ˆå™¨ä¸æ”¯æŒå®šä½');
                    return;
                }

                setLoading(true);
                setStatus('è·å–å®šä½ä¸­â€¦');
                navigator.geolocation.getCurrentPosition(async (pos) => {
                    const loc = {
                        name: 'å½“å‰ä½ç½®',
                        displayName: 'å½“å‰ä½ç½®',
                        latitude: pos.coords.latitude,
                        longitude: pos.coords.longitude
                    };
                    writeLocation(loc);
                    await loadWeather(loc, { force: true });
                    setLoading(false);
                }, (err) => {
                    setStatus(`å®šä½å¤±è´¥ï¼š${err?.message || 'æœªçŸ¥é”™è¯¯'}`);
                    setLoading(false);
                }, { enableHighAccuracy: true, timeout: 10000 });
            };

            const onKeyDown = (e) => { if (e.key === 'Enter') onSearch(); };
            searchBtn.addEventListener('click', onSearch);
            refreshBtn.addEventListener('click', onRefresh);
            geoBtn.addEventListener('click', onGeolocate);
            input.addEventListener('keydown', onKeyDown);

            const saved = readLocation();
            if (saved) {
                currentLoc = saved;
                input.value = saved.name || saved.displayName || '';
                loadWeather(saved);
            } else {
                setStatus('è¾“å…¥åŸå¸‚æŸ¥è¯¢ï¼Œæˆ–ä½¿ç”¨å®šä½');
            }

            return () => {
                searchBtn.removeEventListener('click', onSearch);
                refreshBtn.removeEventListener('click', onRefresh);
                geoBtn.removeEventListener('click', onGeolocate);
                input.removeEventListener('keydown', onKeyDown);
                if (controller) controller.abort();
            };
        }

        const backToTopInit = () => {
            const btn = document.getElementById('back-to-top');
            window.addEventListener('scroll', () => {
                if (window.scrollY > 300) {
                    btn.classList.remove('opacity-0', 'translate-y-10');
                } else {
                    btn.classList.add('opacity-0', 'translate-y-10');
                }
            });
            btn.onclick = () => window.scrollTo({ top: 0, behavior: 'smooth' });
        };

        const themeInit = () => {
            const btn = document.getElementById('theme-toggle');
            const html = document.documentElement;
            const isDark = localStorage.getItem('theme') === 'dark' || (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches);
            if(isDark) html.classList.add('dark');
            btn.onclick = () => {
                html.classList.toggle('dark');
                localStorage.setItem('theme', html.classList.contains('dark') ? 'dark' : 'light');
            };
        };

        document.getElementById('mobile-menu-btn').onclick = () => document.getElementById('mobile-menu').classList.toggle('hidden');

        // Init
        router.init();
        searchManager.init();
        backToTopInit();
        themeInit();
    </script>
</body>
</html>
